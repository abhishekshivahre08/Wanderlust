<% layout("/layouts/boilerplate") %>

    <!-- <body> -->
    <div class="row" mt-3>
        <div class="col-8 offset-3">
            <br>
            <h3> <b><%=listing.title%></b></h3>
        </div>
        <div class="card col-6 offset-3 show-card listing-card">
            <img src="<%=listing.image.url%>" class="card-img-top show-img" alt="Listing_image">
            <div class="card-body ">

                <p class="card-text "> Owend by:<i><%= listing.owner.username %></i></p>

                <p class="card-text ">
                    <%=listing.description%> <br> &#8377; </p>
                <p class="card-text ">
                    <%= Number(listing.price || 0).toLocaleString("en-IN")%>
                </p>
                <p class="card-text ">
                    <%=listing.country%>
                </p>
                <p class="card-text ">
                    <%=listing.location%>
                </p>



            </div>
        </div>

        <% if(currentUser && listing.owner._id.equals(currentUser._id)){ %>
            <div class="show-btn">
                <a href="/Listings/<%=listing.id%>/edit" class="btn btn-dark edit-btn col-1 offset-3">Edit</a>
                <form method="POST" action="/Listings/<%= listing.id%>/?_method=Delete">
                    <button class="btn btn-dark offset-5 ">Delete</button>
                </form>
            </div>
            <% } %>


                <!-- for Review form -->
                <div class="col-8 offset-3" mb-3>
                    <% if(currentUser){ %>
                        <!-- <h4>Please <a href="/login">Login</a> to add a review</h4> -->
                        <hr>
                        <h4>Leave a review</h4>

                        <form method="POST" action="/Listings/<%=listing.id%>/reviews" novalidate class="needs-validation">
                            <div class="mb-3 mt-3">
                                <label for="rating" class="form-label">Rating</label>
                                <fieldset class="starability-slot">


                                    <input type="radio" name="review[rating]" value="1" id="second-rate1" />
                                    <label for="second-rate1" title="Terrible">1 star</label>
                                    <input type="radio" name="review[rating]" value="2" id="second-rate2" />
                                    <label for="second-rate2" title="Not good">2 stars</label>

                                    <input type="radio" name="review[rating]" value="3" id="second-rate3" />
                                    <label for="second-rate3" title="Average">3 stars</label>

                                    <input type="radio" name="review[rating]" value="4" id="second-rate4" />
                                    <label for="second-rate4" title="Very good">4 stars</label>
                                    <input type="radio" name="review[rating]" value="5" id="second-rate5" />
                                    <label for="second-rate5" title="Amazing">5 stars</label>

                                </fieldset>
                            </div>


                            <div class="mb-3 mt-3 ">
                                <label for="comment " class="form-label ">Comments</label>
                                <textarea name="review[comment] " id="comment " cols="30 " rows="5 " class="form-control " required></textarea>
                                <div class="invalid-feedback ">Please add some comments for reiview</div>
                            </div>
                            <button class="btn btn-outline-dark ">Submit</button>
                        </form>
                        <%}%>
                            <!-- for showing  all review  -->
                            <hr>
                            <p><b>All Review</b></p>
                            <div class="row ">
                                <% for(review of listing.reviews){%>
                                    <div class="card col-5 ms-3 mb-3 ">
                                        <div class="card-body ">
                                            <h5 class="card-title ">
                                                @
                                                <%= review.author.username %>
                                            </h5>
                                            <p class="starability-result card-text " data-rating=<%=review.rating%>> </p>
                                            <p class="card-text ">
                                                <%= review.comment%>
                                            </p>
                                            <!-- <p class="card-text ">
                                                <%= review.rating%>stars
                                            </p> -->

                                            <form method="post" action="/Listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE" class="mb-3">
                                                <button class="btn btn-sm btn-dark">Delete</button>
                                            </form>
                                        </div>
                                    </div>
                                    <%}%>
                            </div>
                </div>

    </div>
    <!-- </body> -->